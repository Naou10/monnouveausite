{% liquid
assign p = product
if p == blank and section.settings.product != blank
  assign p = section.settings.product
endif

assign v1 = p.metafields.custom.custom_video_bienfaits.value
assign v2 = p.metafields.custom.custom_video_unboxing.value
assign v3 = p.metafields.custom.custom_video_preparation.value
assign v4 = p.metafields.custom.custom_video_recettes.value
%}

<style>
.ube-video-tabs{
  display:flex;
  gap:12px;
  justify-content:space-between;
  margin-top:12px;
}

.ube-video-tabs__item{
  flex:1;
  display:flex;
  justify-content:center;
  cursor:pointer;
}

.ube-video-tabs__thumb{
  width:72px;
  height:72px;
  border-radius:50%;
  overflow:hidden;
  position:relative;
  border:2px solid rgba(0,0,0,.15);
}

.ube-video-tabs__thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.ube-video-tabs__play{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.25);
}

.ube-video-tabs__play svg{
  width:30px;
  height:30px;
}

.ube-video-tabs__modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.ube-video-tabs__modal.is-open{
  display:flex;
}

.ube-video-tabs__panel{
  width:90%;
  max-width:720px;
  aspect-ratio:16/9;
  background:#000;
  position:relative;
}

.ube-video-tabs__close{
  position:absolute;
  top:8px;
  right:8px;
  width:36px;
  height:36px;
  border:none;
  background:#fff;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
}

.ube-video-tabs__player{
  width:100%;
  height:100%;
}
</style>

<div class="ube-video-tabs" id="ube-video-tabs">
  {% for v in (1..4) %}
    {% assign video = nil %}
    {% if v == 1 %}{% assign video = v1 %}{% endif %}
    {% if v == 2 %}{% assign video = v2 %}{% endif %}
    {% if v == 3 %}{% assign video = v3 %}{% endif %}
    {% if v == 4 %}{% assign video = v4 %}{% endif %}

    {% if video != blank %}
      <div class="ube-video-tabs__item" data-video='{{ video | json }}'>
        <div class="ube-video-tabs__thumb">
          <img src="{{ video.preview_image | image_url: width: 300 }}" alt="">
          <div class="ube-video-tabs__play">
            <svg viewBox="0 0 64 64">
              <circle cx="32" cy="32" r="24" fill="rgba(255,255,255,.9)"/>
              <path d="M28 22v20l16-10-16-10z" fill="#000"/>
            </svg>
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<div class="ube-video-tabs__modal" id="ube-video-modal">
  <div class="ube-video-tabs__panel">
    <button class="ube-video-tabs__close" type="button">âœ•</button>
    <video class="ube-video-tabs__player" controls playsinline></video>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById('ube-video-tabs');
  if(!root) return;

  const modal = document.getElementById('ube-video-modal');
  const player = modal.querySelector('video');
  const closeBtn = modal.querySelector('.ube-video-tabs__close');

  root.querySelectorAll('.ube-video-tabs__item').forEach(item=>{
    item.addEventListener('click',()=>{
      const video = JSON.parse(item.dataset.video);
      if(!video || !video.sources || !video.sources[0]) return;

      player.src = video.sources[0].url;
      player.load();
      modal.classList.add('is-open');
      player.play().catch(()=>{});
    });
  });

  closeBtn.addEventListener('click',()=>{
    modal.classList.remove('is-open');
    player.pause();
    player.src='';
  });

  modal.addEventListener('click',(e)=>{
    if(e.target === modal){
      modal.classList.remove('is-open');
      player.pause();
      player.src='';
    }
  });
})();
</script>
